<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title> </title>
  <style>
    :root {
      --bg: #121212;
      --calc: #1e1e1e;
      --display: #000;
      --btn: #2f2f2f;
      --txt: #fff;
      --accent: #3399ff;
      --glow-red: #00cfff;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--bg);
      font-family: 'Segoe UI', Arial, sans-serif;
      user-select: none;
    }

    .calculator {
      width: 360px;
      background: var(--calc);
      border-radius: 28px;
      padding: 16px;
      box-shadow: 0 50px 80px rgba(0, 0, 0, 0.5);
    }

    .top {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 10px;
    }

    .theme {
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--btn);
      color: var(--txt);
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .display {
      background: var(--display);
      height: 96px;
      padding: 0 20px;
      border-radius: 24px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      font-size: 2.8rem;
      color: var(--txt);
      overflow: hidden;
      white-space: pre;
      direction: ltr;
      text-align: right;
      font-family: monospace;
      text-shadow: 0 0 10px var(--glow-blue);
      transition: font-size 0.2s ease;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 16px;
    }

    button {
      border: none;
      border-radius: 50%;
      width: 72px;
      height: 72px;
      font-size: 1.2rem;
      cursor: pointer;
      background: var(--btn);
      color: var(--txt);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
      position: relative;
      transition: transform 0.12s ease;
    }

    button.glowing {
      box-shadow: 0 0 22px #ff4444, inset 0 0 12px #ff8888;
      background: #5a0000;
    }

    .op {
      color: var(--accent);
    }

    .equal {
      background: var(--accent);
      color: #000;
      border-radius: 36px;
    }

    .zero {
      grid-column: span 2;
      border-radius: 36px;
    }

    @keyframes popIn {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .pop {
      animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="top">
      <button class="theme" onclick="theme(1)"></button>
      <button class="theme" onclick="theme(2)"></button>
      <button class="theme" onclick="theme(3)"></button>
      <button class="theme" onclick="theme(4)"></button>
    </div>

    <div class="display" id="display">0</div>

    <div class="buttons">
      <!--  :  -->
      <button data-action="op" onclick="inputOp('/')" class="op">÷</button>
      <button data-action="percent" onclick="percent()" class="op">%</button>
      <button data-action="back" onclick="back()" class="op"></button>
      <button data-action="clear" onclick="clearAll()" class="op">C</button>

      <!--  :  -->
      <button data-action="op" onclick="inputOp('*')" class="op">×</button>
      <button data-action="num" onclick="inputNum('9')">9</button>
      <button data-action="num" onclick="inputNum('8')">8</button>
      <button data-action="num" onclick="inputNum('7')">7</button>

      <!--  :  -->
      <button data-action="op" onclick="inputOp('-')" class="op"></button>
      <button data-action="num" onclick="inputNum('6')">6</button>
      <button data-action="num" onclick="inputNum('5')">5</button>
      <button data-action="num" onclick="inputNum('4')">4</button>

      <!--  :  -->
      <button data-action="op" onclick="inputOp('+')" class="op">+</button>
      <button data-action="num" onclick="inputNum('3')">3</button>
      <button data-action="num" onclick="inputNum('2')">2</button>
      <button data-action="num" onclick="inputNum('1')">1</button>

      <!--  :  (    "0"    ) -->
      <button data-action="equal" onclick="calculate()" class="equal">=</button>
      <button data-action="dot" onclick="inputDot()">.</button>
      <button data-action="num" onclick="inputNum('0')" class="zero">0</button>
    </div>
  </div>

  <script>
    const display = document.getElementById("display");
    let currentInput = "0";
    let previousInput = "";
    let operation = null;
    let resetScreen = false;
    let activeButton = null;
    let displayedChars = [];

    function getDisplayText() {
      if (operation === null) {
        return currentInput;
      } else {
        if (resetScreen && currentInput === "0") {
          let opSymbol = operation === '*' ? '×' : operation === '/' ? '÷' : operation;
          return `${previousInput} ${opSymbol}`;
        } else {
          let opSymbol = operation === '*' ? '×' : operation === '/' ? '÷' : operation;
          return `${previousInput} ${opSymbol} ${currentInput}`;
        }
      }
    }

    function updateDisplay() {
      const text = getDisplayText();
      const currentChars = text.split('');

      const baseSize = 2.0;
      const maxChars = 14;
      let fontSize = baseSize;
      if (text.length > maxChars) {
        fontSize = Math.max(1.4, baseSize * (maxChars / text.length));
      }
      display.style.fontSize = fontSize + 'rem';

      if (text.length <= displayedChars.length && text === displayedChars.join('')) {
        return;
      }

      display.innerHTML = '';
      displayedChars = currentChars;

      currentChars.forEach((char, i) => {
        const span = document.createElement('span');
        span.textContent = char;
        span.classList.add('pop');
        span.style.animationDelay = `${i * 0.004}s`;
        display.appendChild(span);
      });
    }

    function activateButton(btn) {
      if (activeButton) {
        activeButton.classList.remove('glowing');
      }
      if (btn && !['clear', 'equal'].includes(btn.dataset.action)) {
        btn.classList.add('glowing');
        activeButton = btn;
      } else {
        activeButton = null;
      }
    }

    function inputNum(number) {
      const btn = event.currentTarget;
      activateButton(btn);

      if (resetScreen) {
        currentInput = number;
        resetScreen = false;
      } else {
        if (currentInput === "0") {
          currentInput = number;
        } else {
          if (currentInput.length >= 14) return;
          currentInput += number;
        }
      }
      updateDisplay();
    }

    function inputDot() {
      const btn = event.currentTarget;
      activateButton(btn);

      if (resetScreen) {
        currentInput = "0.";
        resetScreen = false;
      } else if (!currentInput.includes(".")) {
        currentInput += ".";
      }
      updateDisplay();
    }

    function clearAll() {
      activateButton(null);
      currentInput = "0";
      previousInput = "";
      operation = null;
      resetScreen = false;
      displayedChars = [];
      updateDisplay();
    }

    function back() {
      const btn = event.currentTarget;
      activateButton(btn);

      if (operation !== null && resetScreen && currentInput === "0") {
        operation = null;
        currentInput = previousInput;
        previousInput = "";
        resetScreen = false;
      } else if (currentInput.length === 1 || (currentInput.length === 2 && currentInput.startsWith("-"))) {
        currentInput = "0";
      } else {
        currentInput = currentInput.slice(0, -1);
      }
      updateDisplay();
    }

    function percent() {
      const btn = event.currentTarget;
      activateButton(btn);

      const value = parseFloat(currentInput);
      currentInput = (value / 100).toString();
      resetScreen = false;
      updateDisplay();
    }

    function inputOp(op) {
      const btn = event.currentTarget;
      activateButton(btn);

      if (operation !== null) {
        if (!resetScreen) {
          calculate();
          previousInput = currentInput;
          operation = op;
          currentInput = "0";
          resetScreen = true;
        } else {
          operation = op;
          updateDisplay();
          return;
        }
      } else {
        previousInput = currentInput;
        operation = op;
        currentInput = "0";
        resetScreen = true;
      }
      updateDisplay();
    }

    function calculate() {
      activateButton(null);
      if (operation === null || previousInput === "" || resetScreen) return;

      let computation;
      const prev = parseFloat(previousInput);
      const current = parseFloat(currentInput);
      if (isNaN(prev) || isNaN(current)) return;

      switch (operation) {
        case "+": computation = prev + current; break;
        case "-": computation = prev - current; break;
        case "*": computation = prev * current; break;
        case "/":
          if (current === 0) {
            currentInput = "";
            displayedChars = [];
            updateDisplay();
            setTimeout(clearAll, 1500);
            return;
          }
          computation = prev / current;
          break;
        default: return;
      }

      currentInput = computation.toString();
      if (currentInput.length > 14) {
        currentInput = parseFloat(computation.toFixed(10)).toString();
      }

      operation = null;
      previousInput = "";
      resetScreen = true;
      displayedChars = [];
      updateDisplay();
    }

    document.addEventListener("keydown", (e) => {
      if (/[0-9]/.test(e.key)) {
        document.querySelector(`button[onclick*="inputNum('${e.key}')"]`)?.click();
      } else if (e.key === ".") document.querySelector('button[onclick*="inputDot"]')?.click();
      else if (e.key === "Enter" || e.key === "=") document.querySelector('button[onclick*="calculate"]')?.click();
      else if (e.key === "Escape") document.querySelector('button[onclick*="clearAll"]')?.click();
      else if (e.key === "Backspace") document.querySelector('button[onclick*="back"]')?.click();
      else if (e.key === "+") document.querySelector('button[onclick*="inputOp('+')"]')?.click();
      else if (e.key === "-") document.querySelector('button[onclick*="inputOp('-')"]')?.click();
      else if (e.key === "*") document.querySelector('button[onclick*="inputOp('*')"]')?.click();
      else if (e.key === "/") document.querySelector('button[onclick*="inputOp('/')"]')?.click();
    });

    function theme(t) {
      if (t === 1) set("#121212", "#1e1e1e", "#000", "#2f2f2f", "#fff", "#3399ff", "#00cfff");
      if (t === 2) set("#001f2f", "#00334d", "#00151f", "#004d73", "#e0f7ff", "#00e5ff", "#00ffff");
      if (t === 3) set("#1a0026", "#2b003d", "#14001f", "#4a0066", "#f2e6ff", "#c77dff", "#ff00ff");
      if (t === 4) set("#f2f2f2", "#fff", "#ddd", "#e0e0e0", "#000", "#ff9800", "#0077ff");
    }

    function set(bg, calc, displayBg, btn, txt, accent, glow) {
      document.documentElement.style.setProperty("--bg", bg);
      document.documentElement.style.setProperty("--calc", calc);
      document.documentElement.style.setProperty("--display", displayBg);
      document.documentElement.style.setProperty("--btn", btn);
      document.documentElement.style.setProperty("--txt", txt);
      document.documentElement.style.setProperty("--accent", accent);
      document.documentElement.style.setProperty("--glow-blue", glow);
    }

    updateDisplay();
  </script>
</body>
</html>